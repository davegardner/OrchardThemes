@using Orchard.Mvc.Html
@using Orchard.ContentManagement
@using Orchard.Utility.Extensions
@{
    if (Model.Title != null)
    {
        Layout.Title = Model.Title;
    }

    Model.Classes.Add("content-item");

    var contentTypeClassName = ((string)Model.ContentItem.ContentType).HtmlClassify();
    Model.Classes.Add(contentTypeClassName);

    var tag = Tag(Model, "article");

    
    var bookPart = Model.ContentItem.BookPart;
    var author = (bookPart.AuthorFirstName.Value + " " + bookPart.AuthorLastName.Value).Trim();
    var illustrator = (bookPart.IllustratorFirstName.Value + " " + bookPart.IllustratorLastName.Value).Trim();
    var byLine = "";
    if (String.IsNullOrWhiteSpace(author) || String.IsNullOrWhiteSpace(illustrator))
    {
        // only one
        if (String.IsNullOrWhiteSpace(author))
        {
            byLine = illustrator;
        }
        else
        {
            byLine = author;
        }
    }
    else // both
    {
        if (bookPart.Category.Value == "Picture Book")
        {
            byLine = illustrator + " (text: " + author + ")";
        }
        else
        {
            byLine = author + " (illust: " + illustrator + ")";
        }
    }

    var imageUrl = bookPart.CoverImage == null ? "" : bookPart.CoverImage.FirstMediaUrl;
    var title = Model.ContentItem.TitlePart.Title;
    var isbn = bookPart.ISBN.Value;
    var awardsYear = bookPart.AwardsYear.Value;
    // can be > 1 Category
    var category = bookPart.Category.Value;
    // can only be one publisher but this will work no matter what
    string publisher = "";
    var terms = bookPart.Publisher.Terms;
    if (terms != null && terms.Count > 0)
    {
        publisher = terms[0].Name;
    }
    var award = bookPart.Award == null ? "" : bookPart.Award.Value;
}

@*@tag.StartElement
<div class="book-summary">
    <a class="cover" href="@Url.ItemDisplayUrl((ContentItem)Model.ContentItem)">
        <img src="@bookPart.CoverImage.FirstMediaUrl" />
    </a>
    <div class="blurb">
        <div class="category">@bookPart.Category.Value</div>
        <div class="details">
            <div class="title">@Html.ItemDisplayLink((String)Model.ContentItem.TitlePart.Title, (ContentItem)Model.ContentItem)</div>
            <div class="byLine">@byLine</div>
            @if(bookPart.Summary != null)
            {
                <div class="summary">@bookPart.Summary.Value</div>
            }
        </div>
        <a class="more btn btn-sm " href="@Url.ItemDisplayUrl((ContentItem)Model.ContentItem)"><i class='fa fa-arrow-right'></i></a>
    </div>
</div>
@tag.EndElement*@


   @*---------------------------------------------------------------------------*@

<div class='book-summary'>
    <table class="table table-condensed">
        <tr>
            <td class="image">
                <img src="@imageUrl" />
            </td>
            <td class="detail">
                <div class="gongs @award">
                    @award
                </div>
                <div class="title">
                    @title
                </div>
                <div class="byLine">
                    @byLine
                </div>
                <div class="publisher">
                    @publisher
                </div>
                <div class="isbn">
                    ISBN: @isbn
                </div>
                @if (bookPart.Summary != null)
                {
                    <div class="summary">
                        @bookPart.Summary.Value
                    </div>
                }
                <a class="more btn btn-sm btn-info" href="@Url.ItemDisplayUrl((ContentItem)Model.ContentItem)"><i class='fa fa-hand-o-right'></i></a>
            </td>
        </tr>
    </table>
</div>
